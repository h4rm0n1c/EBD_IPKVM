# Log (running)

- 2026-01-30: Switched video transport to UDP over Wi-Fi with per-line RLE compression and a new host receiver/relay helper for VLC testing.
- 2026-01-30: Added a weak cyw43_arch_wifi_scan shim so portal scans can call the wrapper name even when the SDK omits it (fallbacks to the driver API).
- 2026-01-30: Aligned portal scan callback signature with cyw43 scan API to avoid pointer-type warnings.
- 2026-01-30: Updated portal DNS/DHCP UDP receive callbacks to match lwIP udp_recv_fn signatures and silence build warnings.
- 2026-01-30: Adjusted frame gating to transmit every VSYNC (~60 fps) instead of alternating frames.
- 2026-01-30: Added a captive-portal Wi-Fi configuration flow with DHCP/DNS/HTTP setup and flash-stored credentials for UDP streaming.
- 2026-01-30: Keep the HTTP configuration server available in station mode so live config/control is possible without returning to AP mode.
- 2026-01-30: Remove the 100-frame auto-stop and tie PS_ON to auto-arming capture with portal power controls.
- 2026-01-30: Document that Wi-Fi features require building with `PICO_BOARD=pico_w` to pull in cyw43 headers.
- 2026-01-30: Default builds to `PICO_BOARD=pico_w` so Wi-Fi builds work without extra flags.
- 2026-01-30: Force cached `pico` builds to promote to `pico_w` so cyw43 headers resolve without manual cache cleanup.
- 2026-01-30: Add a project `lwipopts.h` and include path so lwIP builds resolve without external config.
- 2026-01-29: Lock classic line capture to HSYNC falling + PIXCLK rising and remove runtime edge toggles/program variants to simplify the PIO program set.
- 2026-01-28: Delayed line capture start by 18 PIXCLKs after XOFF to shift sampling into active video and preserve the rightmost pixels.
- 2026-01-27: Switched capture to VSYNC-ended frame boundaries with ping-pong framebuffers and main-loop line packetization to prevent line-count drift.
- 2026-01-27: Added VSYNC debounce and TX-idle gating so frame delivery stays monotonic under backpressure.
- 2026-01-27: Switched frame DMA to a single contiguous transfer per frame and abort on VSYNC to remove per-line DMA re-arming.
- 2026-01-27: Align active-line extraction to the end of short frames so captures still transmit when total lines dip below the nominal VBL+active count.
- 2026-01-27: Byte-swapped 32-bit PIO RX FIFO words before enqueueing USB line packets to fix 16/32-pixel block ordering artifacts.
- 2026-01-27: Phase-locked PIXCLK after HSYNC in PIO capture to eliminate intermittent 1-pixel horizontal slips.
- 2026-01-27: Forced PIXCLK phase alignment in PIO capture loops so the first sample always follows a real edge.
- 2026-01-27: Fixed capture length to YOFF+ACTIVE lines and finalized frames on DMA completion instead of VSYNC edges.
- 2026-01-27: Adjusted HSYNC anchoring and XOFF to start sampling earlier, removing persistent horizontal wrap.
- 2026-01-27: Anchored HSYNC to per-mode edges, retuned XOFF to 157 PIXCLK cycles, and added a small post-edge sampling delay.
- 2026-01-26: Restored missing helper scripts for CDC command output and A/B capture testing; documented their usage.
- 2026-01-26: Added ATX soft-power, BOOTSEL, and watchdog reset CDC commands; documented GPIO9 PS_ON output.
- 2026-01-26: Defaulted host test helper to send ATX power-on before capture, wait with diagnostics, and request ATX shutdown on exit.
- 2026-01-26: Adjusted host helper defaults to 12s boot wait with diagnostics during boot.
- 2026-01-25: Initial repo scaffolding (README, agents.md, docs/*, .gitignore).
- 2026-01-25: Documented availability of `/opt/MacDevDocs` as a local reference source.
- 2026-01-24: Expanded documentation with current capture behavior, pin map, and USB CDC packet format for host tooling.
- 2026-01-24: Clarified that `src/host_recv_frames.py` is the host-side test program.
- 2026-01-26: Reset counters before arming capture in `host_recv_frames.py` to avoid stale 100-frame runs.
- 2026-01-26: Added a short boot wait after opening CDC in `host_recv_frames.py`, configurable via `--boot-wait`.
- 2026-01-26: Added `--diag-secs` to `host_recv_frames.py` for printing ASCII status before arming capture.
- 2026-01-26: Allow status output to continue after 100-frame completion and avoid parking the main loop.
- 2026-01-26: Stop capture on host exit and pre-stop before arming in `host_recv_frames.py`.
- 2026-01-26: Stop re-arming DMA after a capture window completes to avoid stale DMA activity between runs.
- 2026-01-26: Adjusted GPIO diagnostic command to use polling-based edge sampling to avoid IRQ overload on PIXCLK.
- 2026-01-26: Added a force-capture CDC command and host fallback to trigger capture when VSYNC gating stalls.
- 2026-01-26: Added a synthetic test-frame CDC command and host option to isolate USB streaming from capture issues.
- 2026-01-26: Prevented force-capture fallback from firing during synthetic test-frame runs.
- 2026-01-26: Added a probe packet command and host probe option to sanity-check CDC raw bytes.
- 2026-01-26: Emit a probe packet when starting a synthetic test frame to confirm CDC output immediately.
- 2026-01-26: Queue probe packets until CDC write space is available to avoid missing probes.
- 2026-01-26: Add a debug CDC command to report internal streaming state on demand.
- 2026-01-26: Added a consolidated Macintosh Classic video timing/sync summary and expanded the source index for mac_classic_video_protocol references.
- 2026-01-25: Stream USB CDC packets in chunks so 72-byte line packets transmit on 64-byte endpoints.
- 2026-01-25: Increase line TX queue depth to buffer a full frame and avoid drops on full-speed USB.
- 2026-01-25: Trigger line capture on HSYNC falling edge to test polarity alignment.
- 2026-01-25: Tune horizontal skip to 178 PIXCLK cycles based on VCD reconstruction sweep.
- 2026-01-25: Add CDC commands to toggle HSYNC/VSYNC edges at runtime for capture testing.
- 2026-01-25: Fix missing gpio_irq forward declaration after adding runtime edge toggles.
- 2026-01-25: Add a runtime CDC toggle for PIXCLK edge selection.
- 2026-01-25: Disable internal pullups/pulldowns on PIXCLK/VIDEO/HSYNC/VSYNC to rely on external termination.
